# CLAUDE.md改善スキル — 詳細手順

## ワークフロー

### フェーズ1: 探索

リポジトリ内の全CLAUDE.mdファイルを検索する:

```bash
find . -name "CLAUDE.md" -o -name ".claude.md" -o -name ".claude.local.md" 2>/dev/null | head -50
```

**ファイルの種類と場所:**

| 種類 | 場所 | 目的 |
|------|------|------|
| プロジェクトルート | `./CLAUDE.md` | プライマリプロジェクトコンテキスト（gitにコミット、チームで共有） |
| ローカルオーバーライド | `./.claude.local.md` | 個人/ローカル設定（gitignored、非共有） |
| グローバルデフォルト | `~/.claude/CLAUDE.md` | 全プロジェクトへのユーザー全体のデフォルト |
| パッケージ固有 | `./packages/*/CLAUDE.md` | モノレポのモジュールレベルコンテキスト |
| サブディレクトリ | ネストした場所 | 機能/ドメイン固有のコンテキスト |

**注意:** Claudeは親ディレクトリのCLAUDE.mdファイルを自動的に探索するため、モノレポ設定が自動的に機能する。

### フェーズ2: 品質評価

各CLAUDE.mdファイルについて、品質基準に対して評価する。

**クイック評価チェックリスト:**

| 基準 | 重み | 確認 |
|------|------|------|
| コマンド/ワークフローの文書化 | 高 | ビルド/テスト/デプロイコマンドはあるか？ |
| アーキテクチャの明確さ | 高 | Claudeはコードベース構造を理解できるか？ |
| 非自明なパターン | 中 | 落とし穴やクセが文書化されているか？ |
| 簡潔さ | 中 | 冗長な説明や明らかな情報がないか？ |
| 最新性 | 高 | 現在のコードベース状態を反映しているか？ |
| 実行可能性 | 高 | 指示は実行可能で、曖昧でないか？ |

**品質スコア:**
- **A (90-100)**: 包括的、最新、実行可能
- **B (70-89)**: 良いカバレッジ、小さなギャップあり
- **C (50-69)**: 基本情報あり、主要セクション不足
- **D (30-49)**: 内容が薄いまたは古い
- **F (0-29)**: 存在しないまたは著しく古い

### フェーズ3: 品質レポートの出力

**更新を行う前に必ず品質レポートを出力すること。**

フォーマット:

```
## CLAUDE.md品質レポート

### サマリー
- 発見ファイル数: X
- 平均スコア: X/100
- 更新が必要なファイル: X

### ファイル別評価

#### 1. ./CLAUDE.md (プロジェクトルート)
**スコア: XX/100 (グレード: X)**

| 基準 | スコア | 備考 |
|------|--------|------|
| コマンド/ワークフロー | X/20 | ... |
| アーキテクチャの明確さ | X/20 | ... |
| 非自明なパターン | X/15 | ... |
| 簡潔さ | X/15 | ... |
| 最新性 | X/15 | ... |
| 実行可能性 | X/15 | ... |

**問題点:**
- [具体的な問題をリストアップ]

**推奨する追加内容:**
- [追加すべき内容をリストアップ]

#### 2. ./packages/api/CLAUDE.md (パッケージ固有)
...
```

### フェーズ4: ターゲットを絞った更新

品質レポートを出力した後、更新前にユーザーの確認を求める。

**更新ガイドライン（重要）:**

1. **ターゲットを絞った追加のみ提案する** - 本当に有用な情報に集中する:
   - 分析中に発見したコマンドやワークフロー
   - コード内で見つけた落とし穴や非自明なパターン
   - 明確でなかったパッケージの関係
   - 機能するテストアプローチ
   - 設定の特殊性

2. **最小限に保つ** - 以下を避ける:
   - コードから明らかなことを繰り返す
   - すでにカバーされている汎用的なベストプラクティス
   - 再発しそうにない一時的な修正
   - 一行で十分な場所での冗長な説明

3. **差分を示す** - 各変更について:
   - 更新するCLAUDE.mdファイル
   - 具体的な追加内容（差分または引用ブロックとして）
   - これが将来のセッションにどう役立つかの簡単な説明

**差分フォーマット:**

````markdown
### 更新: ./CLAUDE.md

**理由:** ビルドコマンドが不足していて、プロジェクトの実行方法で混乱が生じていた。

```diff
+ ## クイックスタート
+
+ ```bash
+ npm install
+ npm run dev  # 開発サーバーをポート3000で起動
+ ```
```
````

### フェーズ5: 更新の適用

ユーザーの承認後、Editツールを使って変更を適用する。既存のコンテンツ構造を維持する。

## フラグを立てるべき一般的な問題

1. **古いコマンド**: もう機能しないビルドコマンド
2. **不足している依存関係**: 言及されていない必要なツール
3. **古いアーキテクチャ**: 変更されたファイル構造
4. **不足している環境設定**: 必要な環境変数や設定
5. **壊れたテストコマンド**: 変更されたテストスクリプト
6. **文書化されていない落とし穴**: キャプチャされていない非自明なパターン

## ユーザーへの共有ヒント

推奨事項を提示する際にユーザーに教える:

- **`#`キーショートカット**: Claudeセッション中に `#` を押すと、ClaudeがCLAUDE.mdに学習内容を自動的に組み込む
- **簡潔に保つ**: CLAUDE.mdは人が読めるべき; 冗長より密度が高い方が良い
- **実行可能なコマンド**: 文書化された全コマンドはコピペできる状態にする
- **`.claude.local.md`を使う**: チームと共有しない個人の好みに使用（`.gitignore`に追加）
- **グローバルデフォルト**: ユーザー全体の好みは `~/.claude/CLAUDE.md` に置く

## 優れたCLAUDE.mdの条件

**主要原則:**
- 簡潔で人が読める
- コピペできる実行可能なコマンド
- 汎用的なアドバイスでなく、プロジェクト固有のパターン
- 非自明な落とし穴と警告

**推奨セクション**（関連するものだけ使用）:
- Commands（ビルド、テスト、開発、リント）
- Architecture（ディレクトリ構造）
- Key Files（エントリポイント、設定）
- Code Style（プロジェクト規約）
- Environment（必要な変数、設定）
- Testing（コマンド、パターン）
- Gotchas（特殊性、よくある間違い）
- Workflow（いつ何をするか）
