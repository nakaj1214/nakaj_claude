---
name: finishing-a-development-branch
description: 実装が完了し、全テストが通過した後、作業を統合する方法を決定する必要がある場合に使用する。マージ・PR作成・クリーンアップなど、開発作業を構造化されたオプションで完了させるガイド。「開発ブランチを完了する」「ブランチをマージする」「PRを作成する」「ブランチを終了する」と言及する場合に使用する。
---

# 開発ブランチの完了

## 概要

明確なオプションを提示し、選択されたワークフローを実行して開発作業を完了させる。

**基本原則:** テスト確認 → オプション提示 → 選択実行 → クリーンアップ。

**開始時に宣言:** 「finishing-a-development-branchスキルを使って作業を完了します。」

## プロセス

### ステップ1: テスト確認

**オプションを提示する前に、テストが通ることを確認する:**

```bash
# プロジェクトのテストスイートを実行
npm test / cargo test / pytest / go test ./...
```

**テストが失敗した場合:**
```
テスト失敗（<N>件）。完了前に修正が必要:

[失敗内容を表示]

テストが通るまでマージ/PRに進めません。
```

ここで停止。ステップ2へは進まない。

**テストが通った場合:** ステップ2へ進む。

### ステップ2: ベースブランチを特定する

```bash
# よく使われるベースブランチを試す
git merge-base HEAD main 2>/dev/null || git merge-base HEAD master 2>/dev/null
```

または確認: 「このブランチはmainから分岐しました - 正しいですか？」

### ステップ3: オプションを提示する

以下の4つのオプションを正確に提示する:

```
実装が完了しました。どうしますか？

1. <ベースブランチ>にローカルでマージ
2. プッシュしてPull Requestを作成
3. ブランチをそのままにする（後で対処する）
4. この作業を破棄する

どれを選びますか？
```

**説明は不要** - オプションは簡潔に保つ。

### ステップ4: 選択を実行する

#### オプション1: ローカルでマージ

```bash
# ベースブランチに切り替え
git checkout <ベースブランチ>

# 最新を取得
git pull

# フィーチャーブランチをマージ
git merge <フィーチャーブランチ>

# マージ結果でテストを確認
<テストコマンド>

# テストが通った場合
git branch -d <フィーチャーブランチ>
```

次へ: ワークツリーのクリーンアップ（ステップ5）

#### オプション2: プッシュしてPRを作成

```bash
# ブランチをプッシュ
git push -u origin <フィーチャーブランチ>

# PRを作成
gh pr create --title "<タイトル>" --body "$(cat <<'EOF'
## Summary
<変更内容を2-3項目で>

## Test Plan
- [ ] <検証ステップ>
EOF
)"
```

次へ: ワークツリーのクリーンアップ（ステップ5）

#### オプション3: そのままにする

報告: 「ブランチ <名前> を保持します。ワークツリーは <パス> に保存されています。」

**ワークツリーをクリーンアップしない。**

#### オプション4: 破棄する

**まず確認を取る:**
```
以下が永続的に削除されます:
- ブランチ <名前>
- 全コミット: <コミット一覧>
- <パス> のワークツリー

確認するには 'discard' と入力してください。
```

正確な確認を待つ。

確認された場合:
```bash
git checkout <ベースブランチ>
git branch -D <フィーチャーブランチ>
```

次へ: ワークツリーのクリーンアップ（ステップ5）

### ステップ5: ワークツリーのクリーンアップ

**オプション1、2、4の場合:**

ワークツリーにいるか確認:
```bash
git worktree list | grep $(git branch --show-current)
```

該当する場合:
```bash
git worktree remove <ワークツリーパス>
```

**オプション3の場合:** ワークツリーを保持。

## クイックリファレンス

| オプション | マージ | プッシュ | ワークツリー保持 | ブランチ削除 |
|--------|-------|------|---------------|----------------|
| 1. ローカルマージ | ✓ | - | - | ✓ |
| 2. PR作成 | - | ✓ | ✓ | - |
| 3. そのままにする | - | - | ✓ | - |
| 4. 破棄 | - | - | - | ✓（強制） |

## よくある間違い

**テスト確認をスキップする**
- **問題:** 壊れたコードをマージ、失敗するPRを作成
- **修正:** 常にオプション提示前にテストを確認する

**オープンエンドな質問をする**
- **問題:** 「次は何をすればいいですか？」→ あいまい
- **修正:** 4つの構造化されたオプションを正確に提示する

**ワークツリーの自動クリーンアップ**
- **問題:** 必要かもしれないワークツリーを削除（オプション2、3）
- **修正:** オプション1と4のみクリーンアップする

**破棄の確認なし**
- **問題:** 誤って作業を削除
- **修正:** 「discard」と入力する確認を要求する

## 禁止事項

**してはいけないこと:**
- テストが失敗しているのに進める
- マージ結果のテスト確認なしにマージする
- 確認なしに作業を削除する
- 明示的な要求なしにforce-pushする

**常にすること:**
- オプション提示前にテストを確認する
- 正確に4つのオプションを提示する
- オプション4には「discard」と入力する確認を得る
- オプション1と4のみワークツリーをクリーンアップする

## 連携スキル

**呼び出し元:**
- **subagent-driven-development**（ステップ7）- 全タスク完了後
- **executing-plans**（ステップ5）- 全バッチ完了後

**連携スキル:**
- **using-git-worktrees** - そのスキルで作成されたワークツリーのクリーンアップ
